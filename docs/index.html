<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Weekly K-Line Dashboard</title>
    <!-- SheetJS for Excel parsing -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="style.css?v=28">
</head>

<body>

    <div class="app-shell">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <span class="icon">üìä</span> K-LINE CHECKER
            </div>

            <div class="upload-section">
                <button class="upload-btn" onclick="document.getElementById('file-input').click()">
                    <span>+</span> Import Analysis
                </button>
                <input type="file" id="file-input" accept=".xlsx, .xls" style="display: none"
                    onchange="handleFileSelect(event)">
            </div>

            <!-- Fixed Favorites -->
            <div class="nav-group">
                <div class="nav-group-title">PINNED</div>
                <div id="nav-fav-item" class="nav-item active" onclick="switchTab('favorites')">
                    <span>‚≠ê Favorites</span>
                    <span class="badge" id="fav-count-badge">0</span>
                </div>
            </div>

            <!-- Dynamic Dashboards -->
            <div class="nav-group">
                <div class="nav-group-title">
                    UPLOADS
                </div>
                <div id="tabs-list">
                    <!-- Tabs injected here -->
                </div>
            </div>

            <div style="margin-top: auto; padding: 16px; border-top: 1px solid var(--border-color);">
                <div style="font-size: 12px; color: var(--text-secondary); cursor: pointer;" onclick="clearFavorites()">
                    üóëÔ∏è Clear Favorites
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div id="page-title" class="page-title">Favorites</div>

                <div class="controls">
                    <input type="text" id="add-stock-input" placeholder="Search / Add Code..."
                        style="height: 32px; padding: 0 12px; border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); background: #FFF; width: 200px;">

                    <button onclick="addStockFromInput()"
                        style="height: 32px; padding: 0 16px; font-size: 13px; cursor: pointer;">Search</button>

                    <div style="display:inline-flex; align-items:center; margin-left:12px; gap:8px;">
                        <button class="secondary" onclick="exportFavorites()" title="Export Favorites"
                            style="height:32px; padding:0 12px; background:#fff; border:1px solid var(--border-color); color:var(--text-primary); cursor:pointer;">
                            üì§ Export
                        </button>
                    </div>
                </div>
            </div>

            <!-- Filter Panel -->
            <div class="filter-section" id="filter-section">
                <div class="filter-row">
                    <div class="filter-label" style="display:flex; flex-direction:column; gap:4px;">
                        <span>Concepts:</span>
                        <span id="concept-expand-btn" onclick="toggleConceptExpand()"
                            style="color:var(--primary-color); cursor:pointer; font-size:11px;">[Expand]</span>
                    </div>
                    <div class="filter-tags" id="concept-filter-container">
                        <span class="filter-tag active" onclick="applyFilter('concept', null)">All</span>
                        <!-- Injected JS -->
                    </div>
                </div>
                <div class="filter-row">
                    <div class="filter-label" style="display:flex; flex-direction:column; gap:4px;">
                        <span>Agency:</span>
                        <span id="agency-expand-btn" onclick="toggleAgencyExpand()"
                            style="color:var(--primary-color); cursor:pointer; font-size:11px;">[Expand]</span>
                    </div>
                    <div class="filter-tags" id="agency-filter-container">
                        <!-- Injected JS -->
                    </div>
                </div>
            </div>

            <!-- View Toggle & List Header -->
            <div id="view-toggle-container" style="padding: 12px 24px; display: flex; justify-content: flex-start;">
            </div>

            <!-- Scrollable Grid Area -->
            <div class="scroll-area" id="scroll-area">
                <div id="grid" class="grid-container">
                    <!-- Charts injected here -->
                </div>
            </div>

            <!-- Pagination Footer -->
            <div class="pagination" id="pagination-footer">
                <span id="page-info" style="font-size: 12px; color: var(--text-secondary); margin-right: auto;"></span>

                <button class="page-btn" onclick="prevPage()">Previous</button>
                <span id="current-page-num" style="font-size:13px; font-weight:500; color:var(--text-primary);">1</span>
                <button class="page-btn" onclick="nextPage()">Next</button>
            </div>
        </main>
    </div>

    <!-- Custom Modal -->
    <div id="confirm-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3 style="margin-top:0; font-size:16px;">Confirm Deletion</h3>
            <p id="modal-msg" style="color:#666; font-size:14px; margin: 16px 0;">Are you sure you want to remove this?
            </p>
            <div style="display:flex; justify-content:flex-end; gap:12px;">
                <button onclick="closeModal(false)"
                    style="padding:6px 12px; background:#fff; border:1px solid #ddd; border-radius:4px; cursor:pointer;">Cancel</button>
                <button onclick="closeModal(true)"
                    style="padding:6px 12px; background:#f53f3f; color:#fff; border:none; border-radius:4px; cursor:pointer;">Delete</button>
            </div>
        </div>
    </div>

    <script src="script.js?v=29"></script>
    </script>

</body>

</html>